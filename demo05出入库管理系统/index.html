<!DOCTYPE html>
<html>
 <head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width'>
	<title>wellcome to my website</title>
	<script>
	window.onload = function()//打开页面就运行这段js代码
        {
            getInformationfromloacl();
        }
	//封装操作localStroge方法
	 function handleLocalStorage(method, key, value) {//https://blog.csdn.net/bocongbo/article/details/81772157       //https://www.codehui.net/info/46.html   js操作localstorage
  switch (method) {
    case 'get' : {
      let temp = window.localStorage.getItem(key);
      if (temp) {
        return temp
      } else {
        return false
      }
    }
    case 'set' : {
      window.localStorage.setItem(key, value);
      break
    }
    case 'remove': {
      window.localStorage.removeItem(key);
      break
    }
    default : {
      return false
    }
  }
}
	var num=0;
function addRow(){//加行
	//localStorage.clear();
    var oTable = document.getElementById("oTable");
    var tBodies = oTable.tBodies;
    var tbody = tBodies[0];
	//alert(tbody.rows.length);
    var tr = tbody.insertRow(tbody.rows.length);
    var td_1 = tr.insertCell(0);
    td_1.innerHTML = "<div contenteditable='true'>"+num+"</div>";
	num++;
    var td_2 = tr.insertCell(1);
    td_2.innerHTML = "<div contenteditable='true'></div>";
	var td_3 = tr.insertCell(2);
    td_3.innerHTML = "<div contenteditable='true'></div>";
	var td_4 = tr.insertCell(3);
    td_4.innerHTML = "<div contenteditable='true'></div>";
    }
function saveToLocal(){//储存当前数据到loaclStroge
	var tb = document.getElementById('oTable');
	var rows = tb.rows;	
	var information = new Array();
	for(var i = 1; i<rows.length; i++ ){
		information[i]="#";
	   for(var j = 1; j<rows[i].cells.length; j++ ){    // 遍历该行的 td
			var str=rows[i].cells[j].innerHTML;
			str = str.match(/"true">(\S*)<\/div>/)[1];
			information[i]=information[i]+str;
			for(var k=0;k<j+1;k++){//
				information[i]=information[i]+"#";//#玻璃#透明##1###，方便正则匹配找出信息
			}
			//alert(str);
		  // alert("第"+(i+1)+"行，第"+(j+1)+"个td的值："+str);           // 输出每个td的内容
	   }
	}
	
	if (!window.localStorage) {
	  console.log('浏览器版本太低，不支持localStorage');
	} 
	else {
	 let storage = window.localStorage;
	 for(var i=1;i<rows.length;i++){
		handleLocalStorage('set',i-1, information[i]);
		//log.console(information[i]);
		}
	}
}
function getInformationfromloacl(){ //从localStorage的数据传至表格
	//alert(handleLocalStorage("get",1));
	//alert(localStorage.length);
	//location.reload();
	for(var i=0;i<localStorage.length;i++){
	
		var oTable = document.getElementById("oTable");
		var tBodies = oTable.tBodies;
		
		var tbody = tBodies[0];
		var tr = tbody.insertRow(tbody.rows.length);
		
		var td_1 = tr.insertCell(0);
		td_1.innerHTML = "<div contenteditable='false'>"+i+"</div>";//前面的序号
		
		var td_2 = tr.insertCell(1);//产品名称
		var productName = handleLocalStorage("get",i).match(/#(\S*?)##/)[1];
		td_2.innerHTML = "<div contenteditable='true'>"+productName+"</div>";
		
		var td_3 = tr.insertCell(2);//型号
		var model = handleLocalStorage("get",i).match(/##(\S*?)###/)[1];
		td_3.innerHTML = "<div contenteditable='true'>"+model+"</div>";
		
		var td_4 = tr.insertCell(3);//数量
		var quantity = handleLocalStorage("get",i).match(/###(\S*?)####/)[1];
		td_4.innerHTML = "<div contenteditable='true'>"+quantity+"</div>";
		
	}
	
}
function clearAllLocaStorage(){
	localStorage.clear();
}

function search(){//搜索功能,默认隐藏search_result,搜索到显现search_result
	let key=document.querySelector("#search_key");
	key=key.value;
	key2="/"+key+"/i";
	//alert(key);
	
	for(var i=0;i<localStorage.length;i++){
		str=handleLocalStorage("get",i);
		if(str.search(eval(key2))!=-1){
			//alert(str);
			//显现search_result
			var searchTable = document.getElementById("search_result");    
			searchTable.style.display = "";
			var search_save_to_local_button = document.getElementById("search_save_button");   //button 
			search_save_to_local_button.style.display = "";
			
			var myTableSecondRow= document.getElementById('search_result').rows[1].cells;
			myTableSecondRow[0].innerHTML="<div contenteditable='true'>"+i+"</div>"//序号
			var productName = handleLocalStorage("get",i).match(/#(\S*?)##/)[1];//productName
			myTableSecondRow[1].innerHTML="<div contenteditable='true'>"+productName+"</div>";
			var model = handleLocalStorage("get",i).match(/##(\S*?)###/)[1];//model型号
			myTableSecondRow[2].innerHTML="<div contenteditable='true'>"+model+"</div>";
			var quantity = handleLocalStorage("get",i).match(/###(\S*?)####/)[1];//数量
			myTableSecondRow[3].innerHTML="<div contenteditable='true'>"+quantity+"</div>";
			return str;
		}
	}
	return "nothing";
	
}
function searchChange(){
	
}


	</script>
	<link  href='html_program/319.css' type='text/css' rel='stylesheet'>
	<meta name='author' content='plus'>
 </head>
 <body>
	 <header>
		 <div class='container'>
			 <div id='branding'>
				 <h1>出入库管理</h1>
			 </div>
		 </div>
	 </header>
	 <section id='showcase'>
		 <div class='container'>
			 <p>Wellcome to my website. It is my first website, there are two mobile games I shared.</p>
		 </div>
	</section>
	<fieldset>
<legend>可编辑的表格</legend>
<table id="oTable"  border="3" >
<thead>
<tr>
<th>序号</th>
<th>产品名称</th>
<th>型号</th>
<th>数量</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</fieldset>
<input type="button" onClick="addRow();" style="font-size:16px;" value="新增产品信息"/>
<input type="button" onClick="saveToLocal();" style="font-size:16px;" value="saveToLocal"/>
<input type="button" onClick="clearAllLocaStorage();" style="font-size:16px;" value="清除所有信息"/>
	<br/>
	<br/>
	<br/>
	<div id="box">

        <input type="search" name="search" placeholder="请输入关键字" id="search_key">
        <input type="button" onClick="search();" style="font-size:16px;" value="搜索" id="search_button"/> 
		
		
    </div>
<table id="search_result"  border="3" style="display:none" id="button_default_hidden_of_search"><!--默认隐藏search_result-->
<thead>
<tr>
<th>序号</th>
<th>产品名称</th>
<th>型号</th>
<th>数量</th>
</tr>
</thead>
<tbody>
<td contenteditable='true'></td>
<td contenteditable='true'></td>
<td contenteditable='true'></td>
<td contenteditable='true'></td>
</tbody>
</table>
<input type="button" onClick="searchChange();" style="font-size:16px;display:none" value="saveToLocal" id="search_save_button"/>
 </body>
 <footer>
	 <p>Plus W, Copyright &copy; 2020</p>
 </footer>
</html>